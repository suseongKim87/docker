# 베이스 만들기
docker의 이미지를 만들기 위해서 최소한의 os image를 다운로드 받아야 합니다. (centos, ubuntu etc...)  
예제에서는 centos를 기반으로 하고 있기 때문에 centos 7 을 기반으로 하도록 하겠습니다.  
사실 centos에서 docker project를 하기위해서 버전업 까지 하게되었습니다... linux 서버 설치 관련해서는 다음에 작성하도록 하겠습니다.  

## 1. centOS 7 이미지 다운로드
먼저 centos 7의 기본이 되는 docker hadoop base image를 만들기 위해서는 먼저 centos image를 다운 받아야 합니다.  
```{.text}
docker hub에 있는 centos 관련 이미지를 확인해 볼 수 있습니다.
$ docker search centos
NAME                               DESCRIPTION                                     STARS               OFFICIAL            AUTOMATED
centos                             The official build of CentOS.                   5133                [OK]
ansible/centos7-ansible            Ansible on Centos7                              119                                     [OK]
...
```
아래와 같이 다운로드를 할 경우, CentOS의 offcial image를 다운로드 합니다.  
```{.text}
$ docker pull centos
```

## 2. docker centOS 7 접근하기
일단 다운로드 받은 centOS를 "docker run" 명령어를 통해 실행하고, "docker ps" 명령어로 실행 된 이미지를 확인 합니다.
```{text}
$ docker run -itd centos /bin/bash
dee37ed8d9042bc8f21f9ef97e20b48d103ad79010be67d674f17ced207680d2

$ docker ps
CONTAINER ID        IMAGE        COMMAND             CREATED             STATUS              PORTS              NAMES
dee37ed8d904        centos      "/bin/bash"       10 seconds ago      Up 9 seconds                         eloquent_ishizaka
```
실행된 container를 확인하고, 실행을 합니다. 실행은 "docker exec" 명령어를 통해 실행합니다.
```{text}
$ docker exec -it dee37ed8d904 /bin/bash
[root@dee37ed8d904 /]#
```

## 3. 실행 된 centOS 에서 계정을 생성 하고, yum update 및 필수 라이브러리 Install
centOS를 설치하고 yum을 최신 버전으로 업데이트 하고, 설치에 필요한 package를 install 합니다.  
```{text}
$ yum update
$ yum install -y curl openssh-server openssh-clients rsync wget net-tools rdate

```

## 4. open-jdk 설치 
open-jdk는 oracle-jdk의 유료화로 요즘 많은 개발자들이 옮겨가고 있는 추세입니다.  
우리는 지금까지 jdk를 돈내고 쓴적이 없고, open-jdk가 상용화에 문제가 없으니, jdk는 open-jdk로 진행하였습니다.  
```{text}
yum install -y java-1.8.0-openjdk-devel.x86_64
```

## 5. zookeeper 설치 및 설정
설치에 필요한 파일들은 다운로드 받기 위해서 wget을 설치 했으니, wget 명령어를 통해 다운로드를 해보도록 하겠습니다.  
```{text}
$ wget http://mirror.apache-kr.org/zookeeper/zookeeper-3.4.13/zookeeper-3.4.13.tar.gz
```
다운로드 받은 파일을 풀어주고, 추가적 버전변경이 생길 수 있으므로 symbolic link를 통해 접근 할 수 있도록 합니다.
```{text}
$ tar -zxf zookeeper-3.4.13.tar.gz
$ mv zookeeper-3.4.13 /home/hduser/
$ ln -s /home/hduser/zookeeper-3.4.13 /home/hduser/zookeeper
```
이후, data, logs 폴더를 외부 폴더에 만들어 줍니다. 외부 폴더로 만들어 주는 이유는, docker volume 설정 때문입니다.  
container의 특징상 휘발성 데이터를 가지게 되므로, 외부와 연결되는 폴더를 만들어 데이터를 유지할 수 있도록 하기 위해서 입니다.  
자세한 내용은 다음챕터에서 hadoop을 실행할 때 설명하도록 하겠습니다.  
```{text}
$ ln -s /repository/zookeeper/data /home/hduser/zookeeper/data
$ ln -s /repository/zookeeper/logs /home/hduser/zookeeper/logs
```
다음은 zookeeper 설정파일 입니다. 저는 2대의 namenode(active, standby)를 설정해서 사용합니다.  
```{text}
$ cp /home/hduser/zookeeper/conf/zoo_sample.cfg /home/hduser/zookeeper/conf/zoo.cfg
$ vi zoo.cfg

*** zoo.cfg 설정 ***
# The number of milliseconds of each tick
tickTime=2000
# The number of ticks that the initial
# synchronization phase can take
initLimit=10
# The number of ticks that can pass between
# sending a request and getting an acknowledgement
syncLimit=5
# the directory where the snapshot is stored.
# do not use /tmp for storage, /tmp here is just
# example sakes.
# dataDir=/tmp/zookeeper
# dataDir=/repository/zookeeper/data
dataDir=/home/hduser/zookeeper/data
# dataLogDir=/repository/zookeeper/logs
dataLogDir=/home/hduser/zookeeper/logs
# the port at which the clients will connect
clientPort=2181
# the maximum number of client connections.
# increase this if you need to handle more clients
# maxClientCnxns=60
#
# Be sure to read the maintenance section of the
# administrator guide before turning on autopurge.
#
# http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance
#
# The number of snapshots to retain in dataDir
# autopurge.snapRetainCount=3
# Purge task interval in hours
# Set to "0" to disable auto purge feature
# autopurge.purgeInterval=1
server.1=master:2888:3888
server.2=standby:2888:3888
server.3=slave1:2888:3888
```

#### 4. 환경설정 잡기
